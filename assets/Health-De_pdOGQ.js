import{u as k,a as r,D as n,r as N,j as s,L as p,t as _,F as d,a0 as y,dm as F,dn as T,M,S as D,dp as z,v as R}from"./index-DTLwKrFY.js";import{u as q,T as A}from"./useTable-B9gY8JA0.js";import{D as $}from"./DeviceImage-CmmMipdr.js";import{I as C}from"./InfoAlert-BXO5hx7w.js";import{T as L}from"./Table-DKmoVF1a.js";import{D as V}from"./Duration-_uYoh7tk.js";import{T as u}from"./TimeAgo-CM34pQ71.js";import"./envs-CRUy-_iG.js";import"./DebouncedInput-CTO5Z9WE.js";import"./index-yG0-fBDW.js";import"./defineProperty-CegpTSss.js";function P({sourceIdx:c}){const{t:a,i18n:m}=k(["health","settings","common","zigbee"]),t=r(n(e=>e.bridgeHealth[c])),o=r(n(e=>e.devices[c])),i=r(n(e=>e.webSocketMetrics[c])),f=r(n(e=>e.readyStates[c])),x=z[f],b=N.useMemo(()=>{const e=[];if(t)for(const l in t.devices){const j=o.find(S=>S.ieee_address===l);j&&e.push({device:j,health:t.devices[l]})}return e},[t,o]),w=N.useMemo(()=>[{id:"friendly_name",minSize:175,header:a(e=>e.friendly_name,{ns:"common"}),accessorFn:({device:e})=>`${e.friendly_name} ${e.description??""}`,cell:({row:{original:{device:e}}})=>s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"avatar",children:s.jsx("div",{className:"h-11 w-11",style:{overflow:"visible"},children:s.jsx($,{device:e,disabled:!1})})}),s.jsxs("div",{className:"flex flex-col min-w-0",children:[s.jsx(p,{to:`/device/${c}/${e.ieee_address}/info`,className:"link link-hover truncate",children:e.friendly_name}),e.friendly_name!==e.ieee_address?e.ieee_address:null]})]}),sortingFn:(e,l)=>e.original.device.friendly_name.localeCompare(l.original.device.friendly_name),filterFn:"includesString",meta:{filterVariant:"text",textFaceted:!0}},{id:"ieee_address",minSize:175,header:a(e=>e.ieee_address,{ns:"zigbee"}),accessorFn:({device:e})=>`${e.ieee_address} ${_(e.network_address,4)} ${e.network_address}`,cell:({row:{original:{device:e}}})=>s.jsxs(s.Fragment,{children:[s.jsx("div",{children:s.jsx(p,{to:`/device/${c}/${e.ieee_address}/info`,className:"link link-hover font-mono",children:e.ieee_address})}),s.jsxs("div",{className:"flex flex-row gap-1",children:[s.jsx("span",{className:"badge badge-ghost badge-sm cursor-default font-mono",title:a(l=>l.network_address_hex,{ns:"zigbee"}),children:_(e.network_address,4)}),s.jsx("span",{className:"badge badge-ghost badge-sm cursor-default font-mono",title:a(l=>l.network_address_dec,{ns:"zigbee"}),children:e.network_address})]})]}),sortingFn:(e,l)=>e.original.device.ieee_address.localeCompare(l.original.device.ieee_address),filterFn:"includesString",meta:{filterVariant:"text"}},{id:"messages",header:a(e=>e.messages),accessorFn:({health:e})=>e.messages,filterFn:"inNumberRange",meta:{filterVariant:"range"}},{id:"messages_per_sec",header:a(e=>e.messages_per_sec),accessorFn:({health:e})=>e.messages_per_sec,cell:({row:{original:{health:e}}})=>s.jsx("span",{className:e.messages_per_sec>1?e.messages_per_sec>3?"text-error":"text-warning":e.messages_per_sec<.2?"text-success":"",children:e.messages_per_sec<=.001?a(l=>l.very_low):e.messages_per_sec}),filterFn:"inNumberRange",meta:{filterVariant:"range"}},{id:"leave_count",header:a(e=>e.leave_count),accessorFn:({health:e})=>e.leave_count,filterFn:"inNumberRange",meta:{filterVariant:"range"}},{id:"network_address_changes",header:a(e=>e.network_address_changes),accessorFn:({health:e})=>e.network_address_changes,filterFn:"inNumberRange",meta:{filterVariant:"range"}}],[c,a]),h=q({id:"health-devices",columns:w,data:b,sorting:[{id:"friendly_name",desc:!1}]});if(t.response_time===0)return s.jsxs("div",{className:"alert alert-info alert-soft",role:"alert",children:[s.jsx(d,{icon:y,size:"2xl"}),a(e=>e.awaiting_next_check)]});const v=new Date(t.response_time),g=new Date(i.lastMessageTs);return s.jsxs(s.Fragment,{children:[s.jsx(C,{children:a(e=>e.interview_info)}),s.jsxs("div",{className:"collapse collapse-arrow bg-base-100 shadow mb-3",children:[s.jsx("input",{type:"checkbox"}),s.jsxs("div",{className:"collapse-title text-lg font-semibold text-center w-full",children:[a(e=>e.os)," / ",a(e=>e.process)," / MQTT"]}),s.jsx("div",{className:"collapse-content",children:s.jsxs("div",{className:"flex flex-col gap-3 items-center mb-2 w-full",children:[s.jsxs("p",{className:"text-sm",title:v.toLocaleString(),children:[a(e=>e.last_check),": ",s.jsx(u,{datetime:v,locale:m.language})]}),s.jsxs("div",{className:"stats stats-vertical lg:stats-horizontal shadow",children:[s.jsx("div",{className:"stat place-items-center",children:s.jsx("div",{className:"stat-value text-xl",children:a(e=>e.os)})}),t.os.load_average.some(e=>e!==0)&&s.jsxs("div",{className:"stat place-items-center",children:[s.jsx("div",{className:"stat-title",children:a(e=>e.load_average)}),s.jsx("div",{className:"stat-value text-lg",children:t.os.load_average.join(", ")}),s.jsx("div",{className:"stat-desc",children:s.jsx("a",{href:F,target:"_blank",rel:"noreferrer",className:"link link-hover",children:"1min, 5min, 15min"})})]}),s.jsxs("div",{className:"stat place-items-center",children:[s.jsx("div",{className:"stat-title",children:a(e=>e.ram_usage)}),s.jsxs("div",{className:"stat-value text-lg",children:[t.os.memory_percent," %"]}),s.jsxs("div",{className:"stat-desc",children:[t.os.memory_used_mb," MB"]})]})]}),s.jsxs("div",{className:"stats stats-vertical lg:stats-horizontal shadow",children:[s.jsx("div",{className:"stat place-items-center",children:s.jsx("div",{className:"stat-value text-xl",children:a(e=>e.process)})}),s.jsxs("div",{className:"stat place-items-center",children:[s.jsx("div",{className:"stat-title",children:a(e=>e.uptime)}),s.jsx("div",{className:"stat-value text-lg",children:s.jsx(V,{durationSec:t.process.uptime_sec})})]}),s.jsxs("div",{className:"stat place-items-center",children:[s.jsx("div",{className:"stat-title",children:a(e=>e.ram_usage)}),s.jsxs("div",{className:"stat-value text-lg",children:[t.process.memory_percent," %"]}),s.jsxs("div",{className:"stat-desc",children:[t.process.memory_used_mb," MB"]})]})]}),s.jsxs("div",{className:"stats stats-vertical lg:stats-horizontal shadow",children:[s.jsx("div",{className:"stat place-items-center",children:s.jsx("div",{className:"stat-value text-xl",children:a(e=>e.mqtt,{ns:"settings"})})}),s.jsxs("div",{className:"stat place-items-center",children:[s.jsx("div",{className:"stat-value text-lg",children:s.jsx(d,{icon:T,className:t.mqtt.connected?"text-success":"text-error"})}),s.jsxs("div",{className:"stat-desc",children:[a(e=>e.queued),": ",t.mqtt.queued]})]}),s.jsxs("div",{className:"stat place-items-center",children:[s.jsx("div",{className:"stat-title",children:a(e=>e.published)}),s.jsx("div",{className:"stat-value text-lg",children:t.mqtt.published})]}),s.jsxs("div",{className:"stat place-items-center",children:[s.jsx("div",{className:"stat-title",children:a(e=>e.received)}),s.jsx("div",{className:"stat-value text-lg",children:t.mqtt.received})]})]})]})})]}),s.jsxs("div",{className:"collapse collapse-arrow bg-base-100 shadow mb-3",children:[s.jsx("input",{type:"checkbox"}),s.jsx("div",{className:"collapse-title text-lg font-semibold text-center w-full",children:"WebSocket"}),s.jsx("div",{className:"collapse-content",children:s.jsxs("div",{className:"flex flex-col gap-3 items-center mb-2 w-full",children:[s.jsxs("div",{className:"stats stats-vertical lg:stats-horizontal shadow",children:[M&&s.jsx("div",{className:"stat place-items-center",children:s.jsx("div",{className:"stat-value text-lg",children:s.jsx(D,{idx:c,alwaysShowName:!0})})}),s.jsxs("div",{className:"stat place-items-center",children:[s.jsx("div",{className:"stat-value text-lg",children:s.jsx(d,{icon:R,className:x?.[1]})}),s.jsx("div",{className:"stat-desc",children:x?.[0]})]}),s.jsxs("div",{className:"stat place-items-center",children:[s.jsx("div",{className:"stat-title",children:a(e=>e.reconnects)}),s.jsx("div",{className:"stat-value text-lg",children:i.reconnects})]}),s.jsxs("div",{className:"stat place-items-center",children:[s.jsx("div",{className:"stat-title",children:a(e=>e.pending_requests)}),s.jsx("div",{className:"stat-value text-lg",children:i.pendingRequests})]})]}),s.jsxs("div",{className:"stats stats-vertical lg:stats-horizontal shadow",children:[s.jsxs("div",{className:"stat place-items-center",children:[s.jsx("div",{className:"stat-title",children:a(e=>e.last_message)}),s.jsx("div",{className:"stat-value text-lg",children:s.jsx(u,{datetime:g,locale:m.language})}),s.jsx("div",{className:"stat-desc",children:g.toLocaleString()})]}),s.jsxs("div",{className:"stat place-items-center",children:[s.jsx("div",{className:"stat-title",children:a(e=>e.sent)}),s.jsx("div",{className:"stat-value text-lg",children:i.messagesSent}),s.jsxs("div",{className:"stat-desc",children:[Math.round(i.bytesSent/1024/1024*100)/100," MB"]})]}),s.jsxs("div",{className:"stat place-items-center",children:[s.jsx("div",{className:"stat-title",children:a(e=>e.received)}),s.jsx("div",{className:"stat-value text-lg",children:i.messagesReceived}),s.jsxs("div",{className:"stat-desc",children:[Math.round(i.bytesReceived/1024/1024*100)/100," MB"]})]}),s.jsxs("div",{className:"stat place-items-center",children:[s.jsxs("div",{className:"stat-title",children:[a(e=>e.received),": ",a(e=>e.bridge,{ns:"settings"})]}),s.jsx("div",{className:"stat-value text-lg",children:i.messagesBridge})]}),s.jsxs("div",{className:"stat place-items-center",children:[s.jsxs("div",{className:"stat-title",children:[a(e=>e.received),": ",a(e=>e.devices,{ns:"common"})]}),s.jsx("div",{className:"stat-value text-lg",children:i.messagesDevice})]})]})]})})]}),s.jsx("div",{className:"mb-3",children:s.jsx(A,{...h})}),s.jsx("div",{className:"mb-5",children:s.jsx(L,{id:"health-devices",...h})})]})}export{P as default};
