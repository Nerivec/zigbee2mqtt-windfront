import{j as e,r as x,u as $,L as A,S as q,s as ne,B as N,a as k,g as oe,t as ce,F as g,f as de,M as xe,b as me,c as fe,d as se,e as be,h as pe,i as he,k as ue,l as je,m as E,H as z,n as te,o as ae,A as ie,R as ve,N as Ne,p as H}from"./index-DTLwKrFY.js";import{u as ye,p as ge}from"./useColumnCount-CYuZnsu5.js";import{L as we}from"./LastSeen-_mzTICXk.js";import{L as _e}from"./Lqi-DSJPyS9r.js";import{P as Ee}from"./PowerSource-BtLGM0pk.js";import{D as ke}from"./DeviceImage-CmmMipdr.js";import{u as Ce,o as Se,a as $e,s as Ae,b as De,c as Te,d as Re,e as Le,F as Pe,f as ze}from"./floating-ui.react-ey6TW0xJ.js";import He from"./Exposes-BKHYZ_uT.js";import"./envs-CRUy-_iG.js";import"./TimeAgo-CM34pQ71.js";import"./index-C7JlGbDK.js";import"./DisplayValue-no6ClLSH.js";import"./snakeCase-48ho8VHI.js";import"./_createCompounder-Jh3GrmJ6.js";import"./isObjectLike-BK6keKbA.js";import"./index-yG0-fBDW.js";import"./defineProperty-CegpTSss.js";import"./floating-ui.dom-BSrWR8Gl.js";import"./startCase-Cc7wIt65.js";import"./isObject--vsEa_js.js";import"./FeatureWrapper-bG-1UrkM.js";const Ie=x.memo(({sourceIdx:i,device:r,deviceState:l,deviceAvailability:f,lastSeenConfig:c,onClick:a})=>{const{t:p}=$("zigbee"),o=r.description??r.definition?.description;return e.jsxs("article",{className:`mb-2 card h-[95px] bg-base-200 rounded-box shadow-md ${f==="disabled"?"card-dash border-warning/40":f==="offline"?"card-border border-error/50":"card-border border-base-300"} cursor-pointer will-change-transform transition-transform hover:-translate-y-1`,onClick:b=>{b.target.nodeName!=="A"&&a(i,r,b.currentTarget)},children:[e.jsx("div",{className:"card-body p-1",children:e.jsxs("div",{className:"flex flex-row items-center gap-3 w-full",children:[e.jsx("div",{className:"flex-none h-11 w-11 overflow-visible",children:e.jsx(ke,{disabled:r.disabled,device:r,otaState:l.update?.state})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"truncate",children:e.jsx(A,{to:`/device/${i}/${r.ieee_address}/info`,className:"truncate link link-hover font-semibold",children:r.friendly_name})}),o&&e.jsx("div",{className:"text-xs opacity-50 truncate",title:o,children:o}),e.jsx("div",{className:"text-xs opacity-50",children:e.jsx(we,{lastSeen:l.last_seen,config:c})}),e.jsx("span",{className:"absolute top-2 right-2",children:e.jsx(q,{idx:i,autoHide:!0})})]})]})}),e.jsxs("div",{className:"flex flex-row flex-wrap gap-1 mx-2 mb-2 justify-end items-center",children:[e.jsx("span",{className:"badge badge-soft badge-ghost cursor-default tooltip","data-tip":p(b=>b.lqi),children:e.jsx(_e,{value:l.linkquality})}),e.jsx("span",{className:"badge badge-soft badge-ghost cursor-default tooltip","data-tip":p(b=>b.power),children:e.jsx(Ee,{device:r,batteryPercent:l.battery,batteryState:l.battery_state,batteryLow:l.battery_low,showLevel:!0})})]})]})}),Me=i=>i?.data?e.jsx(Ie,{...i.data}):null,Oe=x.memo(({sourceIdx:i,group:r})=>{const{t:l}=$("zigbee"),f=x.useCallback(async c=>await ne(i,`${r.friendly_name}/set`,{scene_recall:c}),[i,r.friendly_name]);return e.jsx("article",{className:"card bg-base-200 rounded-box shadow-md",children:e.jsxs("div",{className:"card-body p-3",children:[e.jsx("div",{className:"flex flex-row items-center gap-3 w-full",children:e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"truncate",children:[l(c=>c.scenes),":"," ",e.jsx(A,{to:`/group/${i}/${r.id}/devices`,className:"link link-hover font-semibold",children:r.friendly_name})]}),e.jsx("span",{className:"absolute top-2 right-2",children:e.jsx(q,{idx:i,autoHide:!0})})]})}),e.jsx("div",{className:"flex flex-row flex-wrap gap-1 justify-around items-center",children:r.scenes.map(c=>e.jsx(N,{className:"btn btn-outline btn-primary btn-sm",onClick:f,item:c.id,children:c.name},c.id))})]})})}),Ge=x.memo(({devices:i,maxRows:r})=>{const{t:l}=$(["common","availability"]),f=k(a=>a.recentActivityFeed),c=x.useMemo(()=>[...new Array(Math.max(0,r-f.length))],[r,f.length]);return e.jsx("section",{className:"card bg-base-100",children:e.jsxs("div",{className:"card-body py-3",children:[e.jsx("h2",{className:"card-title",children:l(a=>a.recent_activity)}),e.jsxs("ul",{className:`grid grid-rows-${r} gap-1 w-full`,children:[f.map((a,p)=>{let o=a.ieeeAddress;return o||(o=i[a.sourceIdx].find(h=>h.friendly_name===a.friendlyName)?.ieee_address),e.jsxs("li",{className:"flex flex-row gap-1 items-center w-full px-1 rounded-field hover:bg-base-200",children:[e.jsxs("div",{className:"text-xs font-semibold opacity-60 min-w-0 flex-1",children:[e.jsx(q,{idx:a.sourceIdx,autoHide:!0,namePostfix:" –",className:"me-1"}),o?e.jsx(A,{to:`/device/${a.sourceIdx}/${o}/info`,className:"link link-hover font-semibold truncate",children:a.friendlyName}):e.jsx("span",{className:"font-semibold truncate",children:a.friendlyName}),e.jsxs("span",{className:"text-xs text-base-content/60 truncate",children:["— ",a.activity]})]}),e.jsx("div",{children:e.jsx("p",{className:"text-xs text-base-content/60",children:a.time})})]},`${a.friendlyName}-${a.sourceIdx}-${a.activity}-${a.time}-${p}`)}),c.map((a,p)=>e.jsx("li",{className:"flex flex-row gap-3 items-center",children:e.jsx("div",{className:"w-full font-semibold text-xs text-base-content/0",children:"-"})},`placeholder-${p}`))]})]})})}),Ye=x.memo(({selection:{anchor:i,sourceIdx:r,device:l},onClose:f})=>{const{t:c}=$("zigbee"),a=x.useRef(null),{refs:p,floatingStyles:o,context:b}=Ce({elements:{reference:i},open:!0,onOpenChange:s=>{s||f()},middleware:[Se(4),$e({padding:16,crossAxis:!0}),Ae({padding:16,crossAxis:!0}),De({element:a})]}),h=Te(b),C=Re(b,{outsidePress:!0,escapeKey:!0}),{getFloatingProps:u}=Le([h,C]),m=x.useMemo(()=>oe(l),[l]),n=x.useCallback(async s=>await ne(r,`${l.friendly_name}/set`,{scene_recall:s}),[r,l.friendly_name]),v=l.description??l.definition?.description;return e.jsx(Pe,{children:e.jsxs("aside",{ref:p.setFloating,style:o,...u({className:"card bg-base-200 shadow-lg border border-base-300 w-[min(32rem,calc(100vw-2.5rem))] max-h-[90vh] z-11"}),children:[e.jsxs("div",{className:"card-body p-3 gap-2 w-full h-full overflow-hidden",children:[e.jsxs("header",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx(A,{to:`/device/${r}/${l.ieee_address}/info`,className:"truncate link link-hover font-semibold text-lg",children:l.friendly_name}),e.jsx("p",{className:"truncate text-sm opacity-60",children:v}),e.jsx("span",{className:"font-mono badge cursor-default tooltip tooltip-bottom","data-tip":c(s=>s.ieee_address),children:l.ieee_address}),e.jsx("span",{className:"font-mono badge cursor-default tooltip tooltip-bottom","data-tip":c(s=>s.network_address_hex),children:ce(l.network_address,4)}),e.jsx("span",{className:"font-mono badge cursor-default tooltip tooltip-bottom","data-tip":c(s=>s.network_address_dec),children:l.network_address})]}),e.jsx(N,{onClick:f,className:"btn btn-ghost btn-square",children:e.jsx(g,{icon:de})})]}),m.length>0&&e.jsxs("div",{className:"flex flex-row flex-wrap items-center gap-2",children:[c(s=>s.scenes),":",m.map(s=>e.jsx(N,{className:"btn btn-outline btn-primary btn-sm",onClick:n,item:s.id,children:s.name},s.id))]}),e.jsx("div",{className:"w-full h-full overflow-y-auto rounded-box",style:{scrollbarWidth:"thin"},children:e.jsx(He,{sourceIdx:r,device:l})})]}),e.jsx(ze,{ref:a,context:b,className:"fill-base-200 [&>path:first-of-type]:stroke-base-300 [&>path:last-of-type]:stroke-base-300"})]})})});var j=(i=>(i[i.Availability=0]="Availability",i[i.Type=1]="Type",i[i.Lqi=2]="Lqi",i[i.Disabled=3]="Disabled",i))(j||{});const le=[j.Disabled,!0],I=[j.Availability,"offline"],M=[j.Type,"Router"],O=[j.Type,"EndDevice"],G=[j.Type,"GreenPower"],Y=[j.Lqi,50],qe=x.memo(({totalDevices:i,onlineDevices:r,maybeOnlineDevices:l,disabledDevices:f,anyAvailabilityEnabled:c,totalInstances:a,onlineInstances:p,routers:o,endDevices:b,gpDevices:h,lowLqiDevices:C,setQuickFilter:u,quickFilter:m})=>{const{t:n}=$(["common","availability","zigbee","settings"]),v=x.useCallback(s=>{s[0]===j.Type?u(m?.[0]===s[0]&&m?.[1]===s[1]?null:s):u(m?.[0]===s[0]?null:s)},[u,m]);return e.jsx("section",{className:"card bg-base-100 w-full",children:e.jsxs("div",{className:"card-body py-3",children:[e.jsx("h2",{className:"card-title",children:n(s=>s.overview)}),e.jsxs("div",{className:"flex flex-row flex-wrap justify-center gap-y-3",children:[xe?e.jsxs("div",{className:"flex flex-row w-36 xl:w-48 px-2 py-1 gap-3 justify-center border-dashed border-s border-e border-current/25",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-base-content/70",children:n(s=>s.instances)}),e.jsxs("div",{className:`font-semibold text-xl ${p===a?"":"text-error"}`,children:[p," / ",a]}),a>0&&e.jsxs("div",{className:"text-xs text-base-content/50",children:[Math.round(p/a*100),"% ",n(s=>s.online,{ns:"availability"})]})]}),e.jsx("div",{className:"self-center",children:e.jsx(A,{to:"/settings/0/health",className:"link text-primary tooltip tooltip-bottom","data-tip":n(s=>s.health,{ns:"settings"}),children:e.jsx(g,{icon:me,size:"xl"})})})]}):null,e.jsxs("div",{className:"flex flex-row w-36 xl:w-48 px-2 py-1 gap-3 justify-center border-dashed border-s border-e border-current/25",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-base-content/70",children:n(s=>s.devices)}),e.jsx("div",{className:"font-semibold text-xl",children:i}),f>0&&e.jsxs("span",{className:"text-sm text-xs text-base-content/50",children:["+",f," ",n(s=>s.disabled)]})]}),e.jsx("div",{className:"self-center",children:e.jsx(N,{className:`link tooltip tooltip-bottom ${m?.[0]===le[0]?"text-accent/80":"text-primary/80"}`,"data-tip":`${n(s=>s.quick_search)}: ${n(s=>s.disabled,{ns:"common"})}`,onClick:v,item:le,children:e.jsx(g,{icon:fe,size:"xl"})})})]}),c?e.jsxs("div",{className:"flex flex-row w-36 xl:w-48 px-2 py-1 gap-3 justify-center border-dashed border-s border-e border-current/25",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-base-content/70",children:n(s=>s.online,{ns:"availability"})}),e.jsx("div",{className:"font-semibold text-xl",children:e.jsx("span",{className:r===i?void 0:"text-error",children:r})}),l>0&&f>0&&e.jsxs("span",{className:"text-sm text-xs text-base-content/50",children:["+",l," ",n(s=>s.unknown,{ns:"zigbee"})]})]}),e.jsx("div",{className:"self-center",children:e.jsx(N,{className:`link tooltip tooltip-bottom ${m?.[0]===I[0]?"text-accent":"text-primary"}`,"data-tip":`${n(s=>s.quick_search)}: ${n(s=>s.offline,{ns:"availability"})}`,onClick:v,item:I,children:e.jsxs("span",{className:"fa-layers fa-xl",children:[e.jsx(g,{icon:se,className:`${m?.[0]===I[0]?"text-accent/70":"text-primary/70"}`}),e.jsx(g,{icon:be,transform:"shrink-5 down-2 right-1"})]})})})]}):null,e.jsxs("div",{className:"flex flex-row w-36 xl:w-48 px-2 py-1 gap-3 justify-center border-dashed border-s border-e border-current/25",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-base-content/70",children:n(s=>s.Router,{ns:"zigbee"})}),e.jsx("div",{className:"font-semibold text-xl",children:o})]}),e.jsx("div",{className:"self-center",children:e.jsx(N,{className:`link tooltip tooltip-bottom ${m?.[0]===M[0]&&m[1]===M[1]?"text-accent/80":"text-primary/80"}`,"data-tip":`${n(s=>s.quick_search)}: ${n(s=>s.Router,{ns:"zigbee"})}`,onClick:v,item:M,children:e.jsx(g,{icon:pe,size:"xl"})})})]}),e.jsxs("div",{className:"flex flex-row w-36 xl:w-48 px-2 py-1 gap-3 justify-center border-dashed border-s border-e border-current/25",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-base-content/70",children:n(s=>s.EndDevice,{ns:"zigbee"})}),e.jsx("div",{className:"font-semibold text-xl",children:b})]}),e.jsx("div",{className:"self-center",children:e.jsx(N,{className:`link tooltip tooltip-bottom ${m?.[0]===O[0]&&m[1]===O[1]?"text-accent/80":"text-primary/80"}`,"data-tip":`${n(s=>s.quick_search)}: ${n(s=>s.EndDevice,{ns:"zigbee"})}`,onClick:v,item:O,children:e.jsx(g,{icon:he,size:"xl"})})})]}),h>0&&e.jsxs("div",{className:"flex flex-row w-36 xl:w-48 px-2 py-1 gap-3 justify-center border-dashed border-s border-e border-current/25",children:[e.jsx("div",{children:e.jsxs("div",{className:"text-sm text-base-content/70",children:[n(s=>s.Router,{ns:"zigbee"})," - ",n(s=>s.GreenPower,{ns:"zigbee"})]})}),e.jsx("div",{className:"font-semibold text-xl",children:h}),e.jsx("div",{className:"self-center",children:e.jsx(N,{className:`link tooltip tooltip-bottom ${m?.[0]===G[0]&&m[1]===G[1]?"text-accent":"text-primary"}`,"data-tip":`${n(s=>s.quick_search)}: ${n(s=>s.GreenPower,{ns:"zigbee"})}`,onClick:v,item:G,children:e.jsx(g,{icon:ue,size:"xl"})})})]}),C>0&&e.jsxs("div",{className:"flex flex-row w-36 xl:w-48 px-2 py-1 gap-3 justify-center border-dashed border-s border-e border-current/25",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-base-content/70",children:n(s=>s.low_lqi,{ns:"zigbee"})}),e.jsx("div",{className:"font-semibold text-xl text-error",children:C}),e.jsx("div",{className:"text-xs text-base-content/50",children:"< 50"})]}),e.jsx("div",{className:"self-center",children:e.jsx(N,{className:`link tooltip tooltip-bottom ${m?.[0]===Y[0]?"text-accent":"text-primary"}`,"data-tip":`${n(s=>s.quick_search)}: ${n(s=>s.low_lqi,{ns:"zigbee"})}`,onClick:v,item:Y,children:e.jsxs("span",{className:"fa-layers fa-xl",children:[e.jsx(g,{icon:se,className:`${m?.[0]===Y[0]?"text-accent/70":"text-primary/70"}`}),e.jsx(g,{icon:je,transform:"shrink-4 down-2"})]})})})]})]})]})})});function ms(){const i=k(t=>t.readyStates),r=k(t=>t.groups),l=k(t=>t.devices),f=k(t=>t.deviceStates),c=k(t=>t.availability),a=k(t=>t.bridgeInfo),p=ye(),[o,b]=x.useState(E.get(z,null)),[h,C]=x.useState(E.get(te,!0)),[u,m]=x.useState(E.get(ae,!0)),[n,v]=x.useState(void 0);x.useEffect(()=>{o==null?E.remove(z):E.set(z,o)},[o]),x.useEffect(()=>{E.set(te,h)},[h]),x.useEffect(()=>{E.set(ae,u)},[u]);const s=x.useCallback((t,y,w)=>{v(D=>D?.device.ieee_address===y.ieee_address?void 0:{anchor:w,sourceIdx:t,device:y})},[]),R=x.useMemo(()=>{const t=[];let y=0,w=0,D=0,W=0,K=0,U=0,V=0,J=0,X=0,Z=0,F=0;for(let d=0;d<ie.length;d++){K+=1,i[d]===WebSocket.OPEN&&(U+=1);const L=a[d].config.advanced.last_seen,Q=a[d].config.availability.enabled;Q&&(F+=1);for(const _ of l[d]){if(_.type==="Coordinator")continue;switch(_.type){case"Router":V+=1;break;case"EndDevice":J+=1;break;case"GreenPower":X+=1;break}const P=f[d][_.friendly_name]??{};let T="disabled";if(_.disabled)W+=1;else{y+=1;const ee=a[d].config.devices[_.ieee_address]?.availability;T=(ee!=null?!!ee:void 0)??Q?c[d][_.friendly_name]?.state??"offline":"disabled",T==="online"?w+=1:T==="disabled"&&(w+=1,D+=1)}typeof P.linkquality=="number"&&P.linkquality<50&&(Z+=1),t.push({sourceIdx:d,device:_,deviceState:P,deviceAvailability:T,lastSeenConfig:L,onClick:s})}}t.sort((d,L)=>d.device.friendly_name.localeCompare(L.device.friendly_name));let S=[];if(o!=null)switch(o[0]){case j.Disabled:{S=t.filter(d=>d.device.disabled===o[1]);break}case j.Availability:{S=t.filter(d=>d.deviceAvailability===o[1]);break}case j.Type:{S=t.filter(d=>d.device.type===o[1]);break}case j.Lqi:{S=t.filter(d=>typeof d.deviceState.linkquality=="number"&&d.deviceState.linkquality<o[1]);break}}else S=t;return{counters:{totalDevices:y,onlineDevices:w,maybeOnlineDevices:D,disabledDevices:W,anyAvailabilityEnabled:F>0,totalInstances:K,onlineInstances:U,routers:V,endDevices:J,gpDevices:X,lowLqiDevices:Z},deviceData:t,filteredDeviceData:S}},[l,f,a,c,i,o,s]),B=x.useMemo(()=>{const t=[];if(!u)return t;for(let y=0;y<ie.length;y++)for(const w of r[y])w.scenes.length!==0&&t.push({sourceIdx:y,group:w});return t},[u,r]),re=Math.min(ve,R.counters.totalDevices);return e.jsxs(e.Fragment,{children:[e.jsxs(Ne,{children:[e.jsxs("span",{className:"text-sm",children:[H(t=>t.show),": "]}),e.jsx(N,{className:`btn btn-outline btn-sm ${h?"btn-active":""}`,onClick:C,item:!h,children:H(t=>t.recent_activity)}),e.jsx(N,{className:`btn btn-outline btn-sm ${u?"btn-active":""}`,onClick:m,item:!u,children:H(t=>t.group_scenes)})]}),e.jsxs("div",{className:"flex flex-col mb-5",children:[e.jsx(qe,{...R.counters,setQuickFilter:b,quickFilter:o}),h&&e.jsx(Ge,{devices:l,maxRows:re}),e.jsx("div",{className:"divider m-0 mb-1"}),B.length>0&&e.jsx("section",{className:"mb-4 flex flex-row flex-wrap justify-center gap-2",children:B.map(t=>e.jsx(Oe,{...t},t.group.id))}),e.jsx(ge,{useWindowScroll:!0,columnCount:p,data:R.filteredDeviceData,ItemContent:Me,className:"gap-2 select-none"},`device-tiles-${o?.[0]}-${o?.[1]}`),n&&e.jsx(Ye,{selection:n,onClose:()=>v(void 0)})]})]})}export{ms as default};
