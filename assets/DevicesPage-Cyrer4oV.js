import{a as c,u as N,r as l,A as k,s as m,q as V,j as i,S as q,F as z,v as C,L as y,t as F,w as f,N as D,M as I}from"./index-DTLwKrFY.js";import{O as $,A,D as L}from"./oui-CsmPme7p.js";import{D as M}from"./DeviceImage-CmmMipdr.js";import{T as O}from"./Table-DKmoVF1a.js";import{u as T,T as E}from"./useTable-B9gY8JA0.js";import{L as R}from"./LastSeen-_mzTICXk.js";import{L as U}from"./Lqi-DSJPyS9r.js";import{M as B,V as G}from"./VendorLink-BZlqzmcf.js";import"./envs-CRUy-_iG.js";import"./RemoveDeviceModal-BZeBVqD-.js";import"./CheckboxField-C_Qtx-pp.js";import"./InputField-fj8dQezf.js";import"./index-yG0-fBDW.js";import"./defineProperty-CegpTSss.js";import"./DebouncedInput-CTO5Z9WE.js";import"./TimeAgo-CM34pQ71.js";import"./index-C7JlGbDK.js";import"./DisplayValue-no6ClLSH.js";function de(){const u=c(e=>e.devices),b=c(e=>e.deviceStates),n=c(e=>e.bridgeInfo),g=c(e=>e.availability),{t}=N(["zigbee","common","availability"]),w=l.useMemo(()=>{const e=[];for(let a=0;a<k.length;a++)for(const s of u[a])if(s.type!=="Coordinator"){const r=b[a][s.friendly_name]??{},d=n[a].config.devices[s.ieee_address]?.availability,S=$.get(s.ieee_address.slice(2,8))??"?";let o;s.power_source==="Battery"&&(o=!1,"battery"in r?r.battery<20&&(o=!0):"battery_state"in r?r.battery_state==="low"&&(o=!0):"battery_low"in r&&(o=!!r.battery_low)),e.push({sourceIdx:a,device:s,state:r,availabilityState:g[a][s.friendly_name]?.state??"offline",availabilityEnabledForDevice:d!=null?!!d:void 0,batteryLow:o,oui:S})}return e},[u,b,n,g]),p=l.useCallback(async(e,a,s,r)=>{await m(e,"bridge/request/device/rename",{from:a,to:s,homeassistant_rename:r,last:void 0})},[]),v=l.useCallback(async([e,a])=>{await m(e,"bridge/request/device/configure",{id:a})},[]),x=l.useCallback(async([e,a])=>{await m(e,"bridge/request/device/interview",{id:a})},[]),_=l.useCallback(async(e,a,s,r)=>{await m(e,"bridge/request/device/remove",{id:a,force:s,block:r})},[]),j=l.useMemo(()=>[{id:"source",size:60,header:()=>i.jsx("span",{title:t(e=>e.source,{ns:"common"}),children:i.jsx(z,{icon:C})}),accessorFn:({sourceIdx:e})=>V[e],cell:({row:{original:{sourceIdx:e}}})=>i.jsx(q,{idx:e,nameClassName:"hidden md:inline-block"}),filterFn:"equals",meta:{filterVariant:"select",showFacetedOccurrences:!0}},{id:"friendly_name",size:250,minSize:175,header:t(e=>e.friendly_name,{ns:"common"}),accessorFn:({device:e})=>`${e.friendly_name} ${e.description??""}`,cell:({row:{original:{sourceIdx:e,device:a,state:s}}})=>i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"avatar",children:i.jsx("div",{className:"h-11 w-11",style:{overflow:"visible"},children:i.jsx(M,{device:a,otaState:s.update?.state,disabled:a.disabled})})}),i.jsxs("div",{className:"flex-grow flex flex-col min-w-0",children:[i.jsx(y,{to:`/device/${e}/${a.ieee_address}/info`,className:"link link-hover truncate",children:a.friendly_name}),a.description&&i.jsx("div",{className:"max-w-3xs text-xs opacity-50 truncate",title:a.description,children:a.description})]})]}),sortingFn:(e,a)=>e.original.device.friendly_name.localeCompare(a.original.device.friendly_name),filterFn:"includesString",meta:{filterVariant:"text",textFaceted:!0}},{id:"ieee_address",minSize:175,header:t(e=>e.ieee_address),accessorFn:({device:e})=>`${e.ieee_address} ${F(e.network_address,4)} ${e.network_address}`,cell:({row:{original:{sourceIdx:e,device:a}}})=>i.jsxs(i.Fragment,{children:[i.jsx("div",{children:i.jsx(y,{to:`/device/${e}/${a.ieee_address}/info`,className:"link link-hover font-mono",children:a.ieee_address})}),i.jsxs("div",{className:"flex flex-row gap-1",children:[i.jsx("span",{className:"badge badge-ghost badge-sm cursor-default font-mono",title:t(s=>s.network_address_hex),children:F(a.network_address,4)}),i.jsx("span",{className:"badge badge-ghost badge-sm cursor-default font-mono",title:t(s=>s.network_address_dec),children:a.network_address})]})]}),sortingFn:(e,a)=>e.original.device.ieee_address.localeCompare(a.original.device.ieee_address),filterFn:"includesString",meta:{filterVariant:"text"}},{id:"oui",minSize:125,header:"OUI",accessorFn:({oui:e})=>e,filterFn:"includesString",meta:{filterVariant:"text",textFaceted:!0,showFacetedOccurrences:!0}},{id:"model",minSize:175,header:t(e=>e.model),accessorFn:({device:e})=>`${e.definition?.model??""} ${e.model_id??""} ${e.definition?.vendor??e.manufacturer??""}`,cell:({row:{original:{device:e}}})=>i.jsxs(i.Fragment,{children:[i.jsx(B,{modelId:e.model_id,supported:e.supported,definitionModel:e.definition?.model,definitionVendor:e.definition?.vendor}),i.jsx("div",{className:"flex flex-row gap-1",children:i.jsx("span",{className:"badge badge-ghost badge-sm tooltip tooltip-bottom","data-tip":t(a=>a.manufacturer),children:i.jsx(G,{supported:e.supported,definitionVendor:e.definition?.vendor})})})]}),filterFn:"includesString",meta:{filterVariant:"text",textFaceted:!0,showFacetedOccurrences:!0}},{id:"type",size:100,header:t(e=>e.type),accessorFn:({device:e})=>t(a=>a[e.type]),cell:({row:{original:{device:e}}})=>t(a=>a[e.type]),filterFn:"equals",meta:{filterVariant:"select",showFacetedOccurrences:!0}},{id:"lqi",size:70,header:t(e=>e.lqi),accessorFn:({state:e})=>e.linkquality,cell:({row:{original:{state:e}}})=>i.jsx(U,{value:e.linkquality}),filterFn:"inNumberRange",meta:{filterVariant:"range"}},{id:"last_seen",size:120,header:t(e=>e.last_seen),accessorFn:({sourceIdx:e,state:a})=>{const s=f(a.last_seen,n[e].config.advanced.last_seen);return s?Math.round((Date.now()-s)/1e3/60):void 0},cell:({row:{original:{sourceIdx:e,state:a}}})=>i.jsx(R,{lastSeen:a.last_seen,config:n[e].config.advanced.last_seen,fallback:t(s=>s.disabled,{ns:"common"})}),sortingFn:(e,a)=>{const s=f(e.original.state.last_seen,n[e.original.sourceIdx].config.advanced.last_seen),r=f(a.original.state.last_seen,n[a.original.sourceIdx].config.advanced.last_seen);return s>r?-1:s<r?1:0},enableGlobalFilter:!1,filterFn:"inNumberRange",meta:{filterVariant:"range",tooltip:t(e=>e.last_seen_filter_info,{ns:"common"})}},{id:"availability",size:125,header:t(e=>e.availability,{ns:"availability"}),accessorFn:({sourceIdx:e,availabilityState:a,availabilityEnabledForDevice:s,device:r})=>t(d=>d[r.disabled?"disabled":s??n[e].config.availability.enabled?a:"disabled"],{ns:"availability"}),cell:({row:{original:{sourceIdx:e,device:a,availabilityState:s,availabilityEnabledForDevice:r}}})=>i.jsx(A,{disabled:a.disabled,availability:s,availabilityEnabledForDevice:r,availabilityFeatureEnabled:n[e].config.availability.enabled}),filterFn:"equals",meta:{filterVariant:"select",showFacetedOccurrences:!0}},{id:"power_source",size:100,header:t(e=>e.power_source),accessorFn:({device:e})=>e.power_source,filterFn:"equals",meta:{filterVariant:"select",showFacetedOccurrences:!0}},{id:"battery_level",size:100,header:t(e=>e.battery_level),accessorFn:({state:e})=>e.battery??void 0,cell:({row:{original:{state:e,batteryLow:a}}})=>e.battery==null?"N/A":i.jsxs("span",{className:a?"text-error":void 0,children:[String(e.battery),"%"]}),filterFn:"inNumberRange",meta:{filterVariant:"range"}},{id:"battery_low",size:100,header:t(e=>e.battery_low),accessorFn:({batteryLow:e})=>e,cell:({row:{original:{batteryLow:e}}})=>e===void 0?"N/A":i.jsx("span",{className:e?"text-error":void 0,children:String(e)}),filterFn:"equals",meta:{filterVariant:"boolean"}},{id:"disabled",size:100,header:t(e=>e.disabled,{ns:"common"}),accessorFn:({device:e})=>`${!!e.disabled}`,filterFn:"equals",meta:{filterVariant:"select"}},{id:"actions",minSize:130,cell:({row:{original:{sourceIdx:e,device:a,state:s}}})=>i.jsx(L,{sourceIdx:e,device:a,otaState:s.update?.state,homeassistantEnabled:n[e].config.homeassistant.enabled,renameDevice:p,removeDevice:_,configureDevice:v,interviewDevice:x,btnClassName:"btn-sm"}),enableSorting:!1,enableColumnFilter:!1,enableGlobalFilter:!1}],[n,p,_,v,x,t]),h=T({id:"all-devices",columns:j,data:w,visibleColumns:{source:I,type:!1,power_source:!1,battery_level:!1,battery_low:!1,disabled:!1,oui:!1},sorting:[{id:"friendly_name",desc:!1}]});return i.jsxs(i.Fragment,{children:[i.jsx(D,{children:i.jsx(E,{...h})}),i.jsx("div",{className:"mb-5",children:i.jsx(O,{id:"all-devices",...h})})]})}export{de as default};
