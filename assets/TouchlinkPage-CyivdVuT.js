import{r as t,j as s,F as m,B as v,f as G,ag as U,u as J,a as l,A as K,s as F,q as T,S as Q,v as W,L as X,ah as z,ai as Y,aj as Z,N as ee,M as R,ak as se,al as ae}from"./index-DTLwKrFY.js";import{u as ne,g as te,d as ie,c as le,e as re,F as ce,f as oe,o as E,a as de,s as D,b as H}from"./floating-ui.react-ey6TW0xJ.js";import{I as O}from"./InputField-fj8dQezf.js";import{S as V}from"./SelectField-Hd9BNgRL.js";import{T as ue}from"./Table-DKmoVF1a.js";import{u as me,T as fe}from"./useTable-B9gY8JA0.js";import"./envs-CRUy-_iG.js";import"./floating-ui.dom-BSrWR8Gl.js";import"./DebouncedInput-CTO5Z9WE.js";function he({placement:n,buttonClassName:w,buttonIcon:b,buttonTitle:x,title:_,onApply:p,canApply:y,children:N}){const f=t.useRef(null),[g,i]=t.useState(!1),{refs:j,floatingStyles:r,context:d}=ne({open:g,onOpenChange:i,placement:n,middleware:n?[E(8),D({padding:16,crossAxis:!0}),H({element:f})]:[E(8),de({padding:16,crossAxis:!0}),D({padding:16,crossAxis:!0}),H({element:f})]}),h=te(d,{event:"click"}),S=ie(d),c=le(d),{getReferenceProps:I,getFloatingProps:A}=re([h,S,c]),P=t.useCallback(async(...C)=>{await p?.(...C),i(!1)},[p]);return s.jsxs(s.Fragment,{children:[s.jsxs("button",{ref:j.setReference,type:"button",className:w,...I(),children:[b?s.jsx(m,{icon:b}):null,x?s.jsx("span",{children:x}):null]}),g?s.jsx(ce,{children:s.jsxs("aside",{ref:j.setFloating,style:r,...A({className:"card bg-base-200 shadow-lg border border-base-300 w-[min(32rem,calc(100vw-2.5rem))] max-h-[90vh] z-11"}),children:[s.jsxs("div",{className:"card-body px-4 py-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h4",{className:"card-title",children:_}),s.jsx(v,{onClick:()=>i(!1),className:"btn btn-ghost btn-square",children:s.jsx(m,{icon:G})})]}),N,s.jsx("div",{className:"card-actions justify-end",children:s.jsx(v,{onClick:P,className:"btn btn-outline btn-primary btn-square btn-square",disabled:!y,children:s.jsx(m,{icon:U})})})]}),s.jsx(oe,{ref:f,context:d,className:"fill-base-200 [&>path:first-of-type]:stroke-base-300 [&>path:last-of-type]:stroke-base-300"})]})}):null]})}function Ne(){const{t:n}=J(["touchlink","common","zigbee","settings"]),w=l(e=>e.bridgeInfo),b=l(e=>e.touchlinkDevices),x=l(e=>e.devices),_=l(e=>e.touchlinkIdentifyInProgress),p=l(e=>e.touchlinkResetInProgress),y=l(e=>Object.values(e.touchlinkScanInProgress).some(a=>a)),N=l(e=>e.setTouchlinkIdentifyInProgress),f=l(e=>e.setTouchlinkResetInProgress),g=l(e=>e.setTouchlinkScan),[i,j]=t.useState(0),[r,d]=t.useState(""),[h,S]=t.useState(""),[c,I]=t.useState([]);t.useEffect(()=>{d(w[i].network?.extended_pan_id??"")},[i]),t.useEffect(()=>{I(h?h.replaceAll(" ","").split(","):[])},[h]);const A=t.useMemo(()=>{const e=[];for(let a=0;a<K.length;a++){const o=x[a];for(const u of b[a])e.push({sourceIdx:a,touchlinkDevice:u,friendlyName:o.find(k=>k.ieee_address===u.ieee_address)?.friendly_name,identifyInProgress:_[a],resetInProgress:p[a]})}return e},[x,b,_,p]),P=t.useCallback(async e=>{g(e,{inProgress:!0,devices:[]}),await F(e,"bridge/request/touchlink/scan","")},[g]),C=t.useCallback(async([e,a])=>{N(e,!0),await F(e,"bridge/request/touchlink/identify",a)},[N]),q=t.useCallback(async([e,a])=>{f(e,!0),await F(e,"bridge/request/touchlink/factory_reset",a)},[f]),B=t.useCallback(async()=>{await F(i,"bridge/request/action",{action:"philips_hue_factory_reset",params:{extended_pan_id:r,serial_numbers:c}}),S("")},[i,r,c]),L=t.useMemo(()=>(!r||/^0x[a-fA-F0-9]{16}$/.test(r))&&Array.isArray(c)&&c.length>0?c.every(e=>/^[a-fA-F0-9]{6}$/.test(e)):!1,[r,c]),$=t.useMemo(()=>[{id:"source",size:60,header:()=>s.jsx("span",{title:n(e=>e.source,{ns:"common"}),children:s.jsx(m,{icon:W})}),accessorFn:({sourceIdx:e})=>T[e],cell:({row:{original:{sourceIdx:e}}})=>s.jsx(Q,{idx:e,nameClassName:"hidden md:inline-block"}),filterFn:"equals",meta:{filterVariant:"select",showFacetedOccurrences:!0}},{id:"ieee_address",minSize:175,header:n(e=>e.ieee_address,{ns:"zigbee"}),accessorFn:({touchlinkDevice:e})=>e.ieee_address,cell:({row:{original:{sourceIdx:e,touchlinkDevice:a,friendlyName:o}}})=>o?s.jsx("div",{className:"min-w-0",children:s.jsx(X,{to:`/device/${e}/${a.ieee_address}/info`,className:"link link-hover truncate font-mono",children:a.ieee_address})}):a.ieee_address,sortingFn:(e,a)=>e.original.touchlinkDevice.ieee_address.localeCompare(a.original.touchlinkDevice.ieee_address),filterFn:"includesString",meta:{filterVariant:"text"}},{id:"friendly_name",minSize:175,header:n(e=>e.friendly_name,{ns:"common"}),accessorFn:({friendlyName:e})=>e,filterFn:"includesString",sortingFn:(e,a)=>(e.original.friendlyName??e.original.touchlinkDevice.ieee_address).localeCompare(a.original.friendlyName??a.original.touchlinkDevice.ieee_address),meta:{filterVariant:"text",textFaceted:!0}},{id:"channel",minSize:175,header:n(e=>e.channel,{ns:"zigbee"}),accessorFn:({touchlinkDevice:e})=>e.channel,filterFn:"weakEquals",meta:{filterVariant:"select"}},{id:"actions",minSize:130,cell:({row:{original:{sourceIdx:e,touchlinkDevice:a,resetInProgress:o,identifyInProgress:u}}})=>s.jsxs("div",{className:"join join-horizontal",children:[s.jsx(v,{disabled:o||u,item:[e,a],title:n(k=>k.identify),className:"btn btn-sm btn-square btn-outline btn-primary join-item",onClick:C,children:s.jsx(m,{icon:u?z:Y,spin:u})}),s.jsx(v,{disabled:o||u,item:[e,a],title:n(k=>k.factory_reset),className:"btn btn-sm btn-square btn-outline btn-error join-item",onClick:q,children:s.jsx(m,{icon:o?z:Z,spin:o})})]}),enableSorting:!1,enableColumnFilter:!1,enableGlobalFilter:!1}],[n,C,q]),M=me({id:"touchlink-devices",columns:$,data:A,visibleColumns:{source:R},sorting:[{id:"friendly_name",desc:!1}]});return y?s.jsx("div",{className:"flex flex-row justify-center items-center gap-2",children:s.jsx("span",{className:"loading loading-infinity loading-xl"})}):s.jsxs(s.Fragment,{children:[s.jsx(ee,{children:s.jsx(fe,{...M})}),s.jsxs("div",{className:"flex flex-row flex-wrap justify-center items-center gap-2 mb-3",children:[R&&s.jsxs(V,{name:"scan_idx_picker",label:n(e=>e.scan_source),value:i,onChange:e=>!e.target.validationMessage&&!!e.target.value&&j(Number.parseInt(e.target.value,10)),className:"select",children:[s.jsx("option",{value:"",disabled:!0,children:n(e=>e.select_scan_source)}),T.map((e,a)=>s.jsx("option",{value:a,children:e},e))]}),s.jsx("fieldset",{className:"fieldset self-end",children:s.jsxs(v,{className:"btn btn-outline btn-primary",item:i,onClick:P,disabled:y,children:[s.jsx(m,{icon:se}),n(e=>e.scan)]})}),s.jsx("fieldset",{className:"fieldset self-end ml-auto",children:s.jsxs(he,{placement:"bottom-end",canApply:L,onApply:B,buttonClassName:"btn btn-outline btn-error",buttonIcon:ae,buttonTitle:n(e=>e.philips_hue_reset),title:n(e=>e.philips_hue_reset),children:[R&&s.jsxs(V,{name:"scan_idx_picker",label:n(e=>e.source,{ns:"common"}),value:i,onChange:e=>!e.target.validationMessage&&!!e.target.value&&j(Number.parseInt(e.target.value,10)),className:"select",children:[s.jsx("option",{value:"",disabled:!0,children:n(e=>e.source,{ns:"common"})}),T.map((e,a)=>s.jsx("option",{value:a,children:e},e))]}),s.jsx(O,{name:"serial_numbers",label:n(e=>e.serial_numbers),type:"text",value:h,onChange:e=>!e.target.validationMessage&&S(e.target.value)}),s.jsxs("div",{className:"collapse collapse-arrow",children:[s.jsx("input",{type:"checkbox"}),s.jsx("div",{className:"collapse-title font-semibold px-0",children:n(e=>e.advanced,{ns:"settings"})}),s.jsx("div",{className:"collapse-content text-sm pb-2 px-2",children:s.jsx(O,{name:"extended_pan_id",label:n(e=>e.extended_pan_id,{ns:"zigbee"}),type:"text",value:r,onChange:e=>!e.target.validationMessage&&d(e.target.value)})})]})]})})]}),s.jsx("div",{className:"mb-5",children:s.jsx(ue,{id:"touchlink-devices",...M})})]})}export{Ne as default};
