import{E as k,P,b as h,r as l,j as e,Q as R,C as N,F as _,R as U,a as p,k as x,c as u,L as f,$ as z,aD as v,aE as O,aF as y,aB as A,t as T,M as q,S as F,A as I,aC as S}from"./index-BFQ_Rrcw.js";import{s as G}from"./snakeCase-BilpKH8r.js";import{a as H,A as B,D as J}from"./Availability-D5KTI3Gp.js";import{T as V}from"./TextareaField-CbVtSljh.js";import{D as W}from"./DeviceImage-DYpYz5SI.js";import{D as K}from"./DisplayValue-ZtlRXdX7.js";import{L as Q}from"./LastSeen-BEZqgdEU.js";import{M as X,V as Z}from"./VendorLink-ClL_ZY47.js";import{P as Y}from"./PowerSource-B3Yl2iYL.js";import"./envs-CSqIi4cL.js";import"./_createCompounder-BUW0VzD-.js";import"./isArray-BNsEL_P3.js";import"./RemoveDeviceModal-BE8nZkGo.js";import"./CheckboxField-CaA8YhTd.js";import"./InputField-CIKw2Xrr.js";import"./index-CoqysZeI.js";import"./format-C1E149BK.js";const ee=k.create(({device:a,setDeviceDescription:s})=>{const i=P(),{t:n}=h(["zigbee","common"]),[o,c]=l.useState(a.description||"");return l.useEffect(()=>{c(a.description||"")},[a.description]),l.useEffect(()=>{const r=m=>{m.key==="Escape"&&(m.preventDefault(),i.remove())};return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[i]),e.jsx(R,{isOpen:i.visible,title:`${n(r=>r.update_description)} ${a.friendly_name}`,footer:e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"btn btn-neutral",onClick:i.remove,children:n(r=>r.cancel,{ns:"common"})}),e.jsx(N,{className:"btn btn-primary ms-1",onClick:async()=>{i.remove(),await s(a.ieee_address,o)},children:n(r=>r.save_description)})]}),children:e.jsx("div",{className:"flex flex-col gap-2",children:e.jsx(V,{label:n(r=>r.description),name:"update_description",onChange:r=>c(r.target.value),rows:3,value:o})})})}),se=l.memo(({device:a,setDeviceDescription:s})=>{const{t:i}=h("zigbee");return e.jsx(N,{className:`btn btn-link btn-sm${a.description?" btn-square":""}`,onClick:async()=>await k.show(ee,{device:a,setDeviceDescription:s}),title:i(n=>n.edit_description),children:a.description?e.jsx(_,{icon:U}):i(n=>n.edit_description)})}),te=/\[(.*?)]\((.*?)\)/,ae={native:"badge-success",external:"badge-info",generated:"badge-warning"},ie=(a,s)=>{if(!(a==="bindings"||a==="configured_reportings"||a==="scenes"))return s},ne=l.memo(({sourceIdx:a,device:s})=>{const{t:i}=h("zigbee"),n=p(x(c=>c.bridgeInfo[a])),o={template:"external_converter.yaml",title:`[External Converter]: ${s.model_id} from ${s.manufacturer}`,z2m_version:`${n.version} (${n.commit})`,notes:`
software_build_id: \`${s.software_build_id}\`
date_code: \`${s.date_code}\`
endpoints:
\`\`\`json
${JSON.stringify(s.endpoints,ie)}
\`\`\``};return e.jsx(f,{target:"_blank",rel:"noopener noreferrer",to:`${S}?${new URLSearchParams(o).toString()}`,className:"link link-hover",children:i(c=>c.submit_converter)})}),re=l.memo(({sourceIdx:a,device:s})=>{const{t:i}=h("zigbee"),n=p(x(r=>r.bridgeInfo[a])),o=p(x(r=>r.bridgeHealth[a])),c={template:"problem_report.yaml",title:`[${s.model_id} / ${s.manufacturer}] ???`,z2m_version:`${n.version} (${n.commit})`,adapter_fwversion:JSON.stringify(n.coordinator.meta),adapter:n.coordinator.type,setup:`os: \`${n.os.version}\`
node: \`${n.os.node_version}\`
ha: \`${n.config.homeassistant.enabled}\``,notes:`
#### Device
software_build_id: \`${s.software_build_id}\`
date_code: \`${s.date_code}\`
endpoints:
\`\`\`json
${JSON.stringify(s.endpoints)}
\`\`\``};return o.response_time>0&&(c.notes+=`
##### Health
time: \`${new Date(o.response_time)}\`
os.load_average: \`${o.os.load_average.join(", ")}\`
os.memory_percent: \`${o.os.memory_percent}\`
process.memory_percent: \`${o.process.memory_percent}\`
process.uptime_sec: \`${Math.round(o.process.uptime_sec)}\`
\`\`\`json
${JSON.stringify(o.devices[s.ieee_address]??{})}
\`\`\`
`),e.jsx(f,{target:"_blank",rel:"noopener noreferrer",to:`${S}?${new URLSearchParams(c).toString()}`,className:"btn btn-ghost",children:i(r=>r.report_problem)})});function ye({sourceIdx:a,device:s}){const{t:i}=h(["zigbee","availability","common"]),n=p(x(t=>t.deviceStates[a])),o=p(x(t=>t.bridgeInfo[a].config)),c=p(x(t=>t.availability[a])),r=o.homeassistant.enabled,m=l.useMemo(()=>n[s.friendly_name]??{},[s.friendly_name,n]),$=l.useCallback(async(t,d)=>{await u(a,"bridge/request/device/options",{id:t,options:{description:d}})},[a]),g=l.useCallback(async(t,d,b,j)=>{await u(t,"bridge/request/device/rename",{from:d,to:b,homeassistant_rename:j,last:void 0})},[]),D=l.useCallback(async([t,d])=>{await u(t,"bridge/request/device/configure",{id:d})},[]),E=l.useCallback(async([t,d])=>{await u(t,"bridge/request/device/interview",{id:d})},[]),C=l.useCallback(async(t,d,b,j)=>{await u(t,"bridge/request/device/remove",{id:d,force:b,block:j})},[]),w=o.devices[s.ieee_address]?.availability,L=l.useMemo(()=>{const t=s.definition?.description?te.exec(s.definition?.description):void 0;if(t){const[,d,b]=t;return e.jsx(f,{target:"_blank",rel:"noopener noreferrer",to:b,className:"link link-hover",children:d})}return e.jsx(e.Fragment,{children:s.definition?.description})},[s.definition]),M=l.useMemo(()=>{switch(s.interview_state){case v.Pending:return e.jsx(_,{icon:y,className:"text-info"});case v.InProgress:return e.jsx(_,{icon:y,spin:!0,className:"text-info"});case v.Successful:return e.jsx(_,{icon:O,className:"text-success"});default:return e.jsx(_,{icon:z,beat:!0,className:"text-error"})}},[s.interview_state]);return e.jsxs("div",{className:"card lg:card-side bg-base-100",children:[e.jsx("figure",{className:"w-64 h-64",style:{overflow:"visible"},children:e.jsx(W,{device:s,otaState:m.update?.state,disabled:s.disabled})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("h2",{className:"card-title",children:[s.friendly_name,e.jsx(H,{sourceIdx:a,name:s.friendly_name,renameDevice:g,homeassistantEnabled:r,style:"btn-link btn-sm btn-square"})]}),e.jsxs("div",{className:"flex flex-row flex-wrap gap-2",children:[e.jsxs("span",{className:`badge ${s.definition?ae[s.definition.source]:""}`,children:[e.jsx(K,{name:"supported",value:s.supported}),s.definition?`: ${s.definition.source}`:""]}),!s.supported&&e.jsx("span",{className:"badge animate-bounce",children:e.jsx(f,{target:"_blank",rel:"noopener noreferrer",to:A,className:"link link-hover",children:i(t=>t.how_to_add_support)})}),s.definition?.source==="external"&&e.jsx("span",{className:"badge animate-bounce",children:e.jsx(ne,{sourceIdx:a,device:s})}),e.jsxs("span",{className:"badge opacity-70",title:s.interview_state,children:[i(t=>t.interview_state),": ",M]})]}),e.jsxs("div",{children:[e.jsx("pre",{className:"inline text-wrap break-all",children:s.description||""}),e.jsx(se,{device:s,setDeviceDescription:$})]}),e.jsxs("div",{className:"stats stats-vertical lg:stats-horizontal shadow",children:[e.jsxs("div",{className:"stat",children:[e.jsx("div",{className:"stat-title",children:s.type}),e.jsx("div",{className:"stat-value text-xl",title:i(t=>t.ieee_address),children:s.ieee_address}),e.jsx("div",{className:"stat-value text-xl",title:i(t=>t.network_address_hex),children:T(s.network_address)}),e.jsxs("div",{className:"stat-desc",children:[i(t=>t.network_address_dec),": ",s.network_address]})]}),e.jsxs("div",{className:"stat",children:[e.jsx("div",{className:"stat-title",children:i(t=>t.last_seen)}),e.jsx("div",{className:"stat-value text-xl",children:e.jsx(Q,{config:o.advanced.last_seen,lastSeen:m.last_seen})}),e.jsxs("div",{className:"stat-desc",children:[i(t=>t.availability,{ns:"availability"}),": ",e.jsx(B,{availability:c[s.friendly_name]?.state??"offline",disabled:s.disabled,availabilityFeatureEnabled:o.availability.enabled,availabilityEnabledForDevice:w!=null?!!w:void 0})]})]}),e.jsxs("div",{className:"stat",children:[e.jsx("div",{className:"stat-title",children:i(t=>t.power)}),e.jsx("div",{className:"stat-value text-xl",children:e.jsx(Y,{showLevel:!0,device:s,batteryPercent:m.battery,batteryState:m.battery_state,batteryLow:m.battery_low})}),e.jsx("div",{className:"stat-desc",children:s.type==="GreenPower"?"GreenPower":i(t=>t[G(s.power_source)]||t.unknown)})]}),e.jsxs("div",{className:"stat",children:[e.jsx("div",{className:"stat-title",children:i(t=>t.firmware_id)}),e.jsx("div",{className:"stat-value text-xl",children:s.software_build_id||i(t=>t.unknown)}),e.jsx("div",{className:"stat-desc",children:s.date_code||i(t=>t.unknown)})]})]}),e.jsxs("div",{className:"stats stats-vertical lg:stats-horizontal shadow",children:[e.jsxs("div",{className:"stat",children:[e.jsx("div",{className:"stat-title",children:i(t=>t.zigbee_model)}),e.jsx("div",{className:"stat-value text-xl",children:s.model_id}),e.jsxs("div",{className:"stat-desc",children:[s.manufacturer," (",L,")"]})]}),e.jsxs("div",{className:"stat",children:[e.jsx("div",{className:"stat-title",children:i(t=>t.model)}),e.jsx("div",{className:"stat-value text-xl",children:e.jsx(X,{device:s})}),e.jsx("div",{className:"stat-desc",children:e.jsx(Z,{device:s})})]})]}),e.jsxs("div",{className:"stats stats-vertical lg:stats-horizontal shadow",children:[e.jsxs("div",{className:"stat",children:[e.jsx("div",{className:"stat-title",children:"MQTT"}),e.jsxs("div",{className:"stat-value text-xl",children:[o.mqtt.base_topic,"/",s.friendly_name]})]}),q&&e.jsxs("div",{className:"stat",children:[e.jsx("div",{className:"stat-title",children:i(t=>t.source,{ns:"common"})}),e.jsx("div",{className:"stat-value text-xl",children:e.jsx(F,{idx:a,alwaysShowName:!0})}),e.jsx("div",{className:"stat-desc",children:I[a]})]})]}),e.jsxs("div",{className:"card-actions justify-end mt-2",children:[e.jsx(re,{sourceIdx:a,device:s}),e.jsx(J,{sourceIdx:a,device:s,otaState:m.update?.state,homeassistantEnabled:r,renameDevice:g,configureDevice:D,interviewDevice:E,removeDevice:C})]})]})]})}export{ye as default};
