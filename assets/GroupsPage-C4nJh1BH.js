import{Y as w,a2 as G,u as F,r,j as n,a3 as I,B as g,a as q,A as E,s as x,q as v,S as M,F as f,v as $,L as N,a4 as T,a5 as z,X as L,N as R,M as _,a6 as A}from"./index-DTLwKrFY.js";import{I as b}from"./InputField-fj8dQezf.js";import{S as V}from"./SelectField-Hd9BNgRL.js";import{T as B}from"./Table-DKmoVF1a.js";import{u as P,T as D}from"./useTable-B9gY8JA0.js";import"./envs-CRUy-_iG.js";import"./DebouncedInput-CTO5Z9WE.js";const O=w.create(({sourceIdx:m,name:l,onRename:o})=>{const c=G(),{t}=F(["groups","common"]),[u,d]=r.useState(l);return r.useEffect(()=>{d(l)},[l]),r.useEffect(()=>{const a=p=>{p.key==="Escape"&&(p.preventDefault(),c.remove())};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[c]),n.jsx(I,{isOpen:c.visible,title:`${t(a=>a.rename_group)} ${l}`,footer:n.jsxs(n.Fragment,{children:[n.jsx(g,{className:"btn btn-neutral",onClick:c.remove,children:t(a=>a.cancel,{ns:"common"})}),n.jsx(g,{className:"btn btn-primary ms-1",onClick:async()=>{u&&(c.remove(),await o(m,l,u))},children:t(a=>a.rename_group)})]}),children:n.jsx("div",{className:"flex flex-col gap-2",children:n.jsx(b,{name:"friendly_name",label:t(a=>a.friendly_name,{ns:"common"}),onChange:a=>d(a.target.value),value:u,type:"text",required:!0})})})});function W(){const[m,l]=r.useState(""),[o,c]=r.useState(""),[t,u]=r.useState(0),d=q(e=>e.groups),{t:a}=F(["groups","common"]),p=r.useMemo(()=>{const e=[];for(let s=0;s<E.length;s++)for(const i of d[s])e.push({sourceIdx:s,group:i});return e},[d]),S=r.useCallback(async()=>{const e={friendly_name:m};o&&(e.id=o),await x(t,"bridge/request/group/add",e),l(""),c(""),u(0)},[m,o,t]),h=r.useCallback(async(e,s,i)=>await x(e,"bridge/request/group/rename",{from:s,to:i}),[]),j=r.useCallback(async([e,s])=>await x(e,"bridge/request/group/remove",{id:s}),[]),C=r.useMemo(()=>m?!o||!d[t].find(e=>e.id.toString()===o):!1,[m,o,t,d]),k=r.useMemo(()=>[{id:"source",size:60,header:()=>n.jsx("span",{title:a(e=>e.source,{ns:"common"}),children:n.jsx(f,{icon:$})}),accessorFn:({sourceIdx:e})=>v[e],cell:({row:{original:{sourceIdx:e}}})=>n.jsx(M,{idx:e,nameClassName:"hidden md:inline-block"}),filterFn:"equals",meta:{filterVariant:"select",showFacetedOccurrences:!0}},{id:"friendly_name",size:250,minSize:175,header:a(e=>e.friendly_name,{ns:"common"}),accessorFn:({group:e})=>`${e.friendly_name} ${e.description??""}`,cell:({row:{original:{sourceIdx:e,group:s}}})=>n.jsxs("div",{className:"flex-grow flex flex-col min-w-0",children:[n.jsx(N,{to:`/group/${e}/${s.id}/devices`,className:"link link-hover truncate",children:s.friendly_name}),s.description&&n.jsx("div",{className:"max-w-3xs text-xs opacity-50 truncate",title:s.description,children:s.description})]}),sortingFn:(e,s)=>e.original.group.friendly_name.localeCompare(s.original.group.friendly_name),filterFn:"includesString",meta:{filterVariant:"text",textFaceted:!0}},{id:"group_id",minSize:175,header:a(e=>e.group_id),accessorFn:({group:e})=>e.id,cell:({row:{original:{sourceIdx:e,group:s}}})=>n.jsx(N,{to:`/group/${e}/${s.id}/devices`,className:"link link-hover",children:s.id}),filterFn:"weakEquals",meta:{filterVariant:"text"}},{id:"members",size:125,header:a(e=>e.group_members),accessorFn:({group:e})=>e.members.length??0,filterFn:"inNumberRange",meta:{filterVariant:"range"}},{id:"scenes",size:125,header:a(e=>e.group_scenes),accessorFn:({group:e})=>e.scenes.length??0,filterFn:"inNumberRange",meta:{filterVariant:"range"}},{id:"actions",minSize:130,cell:({row:{original:{sourceIdx:e,group:s}}})=>n.jsxs("div",{className:"join join-horizontal",children:[n.jsx(g,{className:"btn btn-sm btn-square btn-outline btn-primary join-item",onClick:async()=>await w.show(O,{sourceIdx:e,name:s.friendly_name,onRename:h}),title:a(i=>i.rename_group),disabled:s.friendly_name==="default_bind_group",children:n.jsx(f,{icon:T})}),n.jsx(z,{title:a(i=>i.remove_group),item:[e,s.id.toString()],onClick:j,className:"btn btn-sm btn-square btn-outline btn-error join-item",modalDescription:a(i=>i.dialog_confirmation_prompt,{ns:"common"}),modalCancelLabel:a(i=>i.cancel,{ns:"common"}),children:n.jsx(f,{icon:L})})]}),enableSorting:!1,enableColumnFilter:!1,enableGlobalFilter:!1}],[h,j,a]),y=P({id:"all-groups",columns:k,data:p,visibleColumns:{source:_},sorting:[{id:"friendly_name",desc:!1}]});return n.jsxs(n.Fragment,{children:[n.jsx(R,{children:n.jsx(D,{...y})}),n.jsxs("div",{className:"flex flex-row flex-wrap justify-center gap-2 mb-2",children:[_&&n.jsx(V,{name:"source",label:a(e=>e.source,{ns:"common"}),value:t,required:!0,onChange:e=>!e.target.validationMessage&&u(Number.parseInt(e.target.value,10)),className:"select",children:v.map((e,s)=>n.jsx("option",{value:s,children:e},`${s}-${e}`))}),n.jsx(b,{type:"text",name:"friendly_name",label:a(e=>e.friendly_name,{ns:"common"}),value:m,placeholder:a(e=>e.friendly_name_placeholder),onChange:e=>l(e.target.value),required:!0,minLength:1,className:"input"}),n.jsx(b,{type:"number",name:"group_id",label:a(e=>e.group_id),value:o,min:0,max:255,onChange:e=>c(e.target.value),className:"input"}),n.jsx("fieldset",{className:"fieldset self-end",children:n.jsxs(g,{onClick:S,className:"btn btn-outline btn-primary",disabled:!C,children:[n.jsx(f,{icon:A}),a(e=>e.create_group)]})})]}),n.jsx("div",{className:"mb-5",children:n.jsx(B,{id:"all-groups",...y})})]})}export{W as default};
